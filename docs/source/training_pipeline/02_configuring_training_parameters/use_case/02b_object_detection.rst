.. include:: /include/substitution.rst

****************
Object Detection
****************

* :ref:`detection-config-files-mainconfig`
* :ref:`detection-config-files-datamodule`
* :ref:`detection-config-files-dataset`
* :ref:`detection-config-files-model`
* :ref:`detection-config-files-model_analysis`
* :ref:`detection-config-files-trainer`

.. _detection-config-files-mainconfig:

Main Config
===========

Config File: ``peekingduck/training/configs/config.yaml``

+---------------------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Key                                   | Value                                               | Description                                                                                                                                                |
+=======================================+=====================================================+============================================================================================================================================================+
| :mod:`project_name`                   | “your_project_name”                                 | your_project_name will be used as your output folder                                                                                                       |
+---------------------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
| :mod:`defaults`                       |                                                     |                                                                                                                                                            |
+--+------------------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  | :mod:`use_case`                    | detection                                           | Type of the model to be trained and used.                                                                                                                  |
+--+------------------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  | :mod:`data_module`                 | :grey:`${use_case}`                                 |                                                                                                                                                            |
+--+------------------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  | :grey:`model`                      | :grey:`${use_case}`                                 |                                                                                                                                                            |
+--+------------------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  | :grey:`trainer`                    | :grey:`${use_case}`                                 |                                                                                                                                                            |
+--+------------------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  | :grey:`callbacks`                  | :grey:`${use_case}`                                 |                                                                                                                                                            |
+--+------------------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  | :grey:`metrics`                    | :grey:`${use_case}`                                 |                                                                                                                                                            |
+--+------------------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  | :grey:`model_analysis`             | :grey:`${use_case}`                                 |                                                                                                                                                            |
+--+------------------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  | :grey:`stores`                     | :grey:`${use_case}`                                 |                                                                                                                                                            |
+--+------------------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  | :grey:`override hydra/job_logging` | :grey:`custom`                                      |                                                                                                                                                            |
+--+------------------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
| :grey:`hydra`                         |                                                     |                                                                                                                                                            |
+--+------------------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  | :grey:`run`                        |                                                     |                                                                                                                                                            |
+--+-----------+------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  |           | :grey:`dir`            | :grey:`outputs/${project_name}/${stores.unique_id}` |                                                                                                                                                            |
+--+-----------+------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  | :grey:`sweep`                      |                                                     |                                                                                                                                                            |
+--+-----------+------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  |           | :grey:`dir`            | :grey:`outputs/${project_name}/${stores.unique_id}` |                                                                                                                                                            |
+--+-----------+------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  |           | :grey:`subdir`         | :grey:`${hydra.job.num}`                            |                                                                                                                                                            |
+--+-----------+------------------------+-----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+

----------

.. _detection-config-files-datamodule:

Data Module
===========

Config File : ``peekingduck/training/configs/data_module/detection.yaml``

+---------------------------------------------------------+----------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Key                                                     | Value                                              | Description                                                                                                                                                                                                                                                                                             |
+=========================================================+====================================================+========+================================================================================================================================================================================================================================================================================================+
| :mod:`dataset_format`                                   |:mod:`coco`                                         | "coco" | 'voc'                                                                                                                                                                                                                                                                                          |
+--------------------------+------------------------------+----------------------------------------------------+--------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| :grey:`defaults`         |                              |                                                    |                                                                                                                                                                                                                                                                                                         |
+--------------------------+------------------------------+----------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                          | :mod:`dataset`               | :mod:`fashion`                                     |                                                                                                                                                                                                                                                                                                         |
+--------------------------+------------------------------+----------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

----------

.. _detection-config-files-dataset:

Dateset
=======

Config File: ``peekingduck/training/configs/data_module/dataset/fashion.yaml``

+---------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------+
| Key                                   | Value                                                                             | Description                                                |
+=======================================+===================================================================================+============================================================+
| :mod:`download`                       | True                                                                              | Whether to download dataset                                |
+---------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------+
| :grey:`url`                           | "https://storage.googleapis.com/peekingduck/data/fashion_coco_format.zip"         | url to download dataset                                    |
+---------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------+
| :mod:`blob_file`                      | "fashion_coco_format.zip"                                                         | Filename of dataset                                        |
+---------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------+
| :mod:`root_dir`                       | "data"                                                                            | Dataset folder                                             |
+---------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------+
| :grey:`data_dir`                      | :grey:`"${.root_dir}/fashion_dataset_for_object_detection_coco_format"`           | full path to dataset                                       |
+---------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------+
| :mod:`num_classes`                    | 11                                                                                | Number of classes in dataset                               |
+---------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------+
| :mod:`train_ann`                      | "instances_train2017.json"                                                        | Annotation filename for training set                       |
+---------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------+
| :mod:`val_ann`                        | "instances_val2017.json"                                                          | Annotation filename for validation set                     |
+---------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------+
| :mod:`test_ann`                       | null                                                                              | Annotation filename for test set                           |
+---------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------+
| :mod:`image_sets`                     | null                                                                              |                                                            |
+---------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------+

----------


.. _detection-config-files-model:

Model
=====


| The model class will make use of these configs.
| Config File : ``peekingduck/training/configs/model/detection.yaml``

+------------------------------------------------------------------+----------------------------------------------+----------------+
| Key                                                              | Value                                        | Description    |
+==================================================================+==============================================+================+
| :grey:`yolox_s`                                                  |                                              |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`depth`               | :grey:`0.33`                                 |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`width`               | :grey:`0.50`                                 |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`input_size`          | :grey:`[224, 224]`                           |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`test_size`           | :grey:`[224, 224]`                           |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
| :grey:`yolox_m`                                                  |                                              |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`depth`               | :grey:`0.67`                                 |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`width`               | :grey:`0.75`                                 |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
| :grey:`yolox_l`                                                  |                                              |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`depth`               | :grey:`0.1`                                  |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`width`               | :grey:`0.1`                                  |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
| :grey:`yolox_x`                                                  |                                              |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`depth`               | :grey:`1.33`                                 |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`width`               | :grey:`1.25`                                 |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
| :grey:`yolox_nano`                                               |                                              |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`depth`               | :grey:`0.33`                                 |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`width`               | :grey:`0.25`                                 |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`mosaic_scale`        | :grey:`[0.5, 1.5]`                           |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`random_size`         | :grey:`[10, 20]`                             |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`input_size`          | :grey:`[416, 416]`                           |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`test_size`           | :grey:`[416, 416]`                           |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`mosaic_prob`         | :grey:`0.5`                                  |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`enable_mixup`        | :grey:`False`                                |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
| :grey:`yolox_tiny`                                               |                                              |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`depth`               | :grey:`0.33`                                 |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`width`               | :grey:`0.375`                                |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`mosaic_scale`        | :grey:`[0.5, 1.5]`                           |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`random_size`         | :grey:`[10, 20]`                             |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`input_size`          | :grey:`[416, 416]`                           |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`test_size`           | :grey:`[416, 416]`                           |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+
|                                    | :grey:`enable_mixup`        | :grey:`False`                                |                |
+------------------------------------+-----------------------------+----------------------------------------------+----------------+

----------


.. _detection-config-files-model_analysis:

Model Analysis
==============


| The model_analysis class will make use of these configs.
| Config File : ``peekingduck/training/configs/model_analysis/detection.yaml``

+--------------------------------------------------------------------+----------------------------------------------------------+----------------+
| Key                                                                | Value                                                    | Description    |
+====================================================================+==========================================================+================+
| :grey:`wandb`                                                      |                                                          |                |
+------------------------------------+-------------------------------+----------------------------------------------------------+----------------+
|                                    | :grey:`wandb-project`         | :grey:`${project_name}`                                  |                |
+------------------------------------+-------------------------------+----------------------------------------------------------+----------------+
|                                    | :grey:`wandb-entity`          | :grey:`${project_name}`                                  |                |
+------------------------------------+-------------------------------+----------------------------------------------------------+----------------+
|                                    | :grey:`wandb-name`            | :grey:`${project_name}-${stores.unique_id}`              |                |
+------------------------------------+-------------------------------+----------------------------------------------------------+----------------+
|                                    | :grey:`wandb-id`              | :grey:`${stores.unique_id}`                              |                |
+------------------------------------+-------------------------------+----------------------------------------------------------+----------------+
|                                    | :grey:`wandb-save_dir`        | :grey:`"./outputs/${project_name}/${stores.unique_id}/"` |                |
+------------------------------------+-------------------------------+----------------------------------------------------------+----------------+
|                                    | :grey:`wandb-num_eval_images` | :grey:`null`                                             |                |
+------------------------------------+-------------------------------+----------------------------------------------------------+----------------+
|                                    | :grey:`wandb-log_checkpoints` | :grey:`True`                                             |                |
+------------------------------------+-------------------------------+----------------------------------------------------------+----------------+

----------


.. _detection-config-files-trainer:

Trainer
=======


| The trainer class will make use of these configs.
| Config File : ``peekingduck/training/configs/trainer/detection.yaml``

+--------------------------------------------------------------------------------------------+--------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| Key                                                                                        | Value                                                  | Description                                                                                                                                        |
+============================================================================================+========================================================+====================================================================================================================================================+
| :grey:`yolox`                                                                              |                                                        |                                                                                                                                                    |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
|                                    | :mod:`epochs`                                         | 10                                                     | Number of epochs to train                                                                                                                          |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
|                                    | :mod:`name`                                           | null                                                   |                                                                                                                                                    |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
|                                    | :mod:`resume`                                         | False                                                  |                                                                                                                                                    |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
|                                    | :mod:`devices`                                        | 1                                                      |                                                                                                                                                    |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
|                                    | :mod:`batch_size`                                     | 8                                                      |                                                                                                                                                    |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
|                                    | :mod:`max_epoch`                                      | 10                                                     |                                                                                                                                                    |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
|                                    | :mod:`fp16`                                           | True                                                   |                                                                                                                                                    |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
|                                    | :grey:`occupy`                                        | null                                                   |                                                                                                                                                    |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+-----------+-----------+-----------+-----------+--------------+-------------------------------------------------------------------------------------+
|                                    | :mod:`model`                                          | :mod:`yolox_s`                                         | "yolox_s" | "yolox_m" | "yolox_l" | "yolox_x" | "yolox_nano" | "yolox_tiny"                                                                        |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+-----------+-----------+-----------+-----------+--------------+-------------------------------------------------------------------------------------+
|                                    | :mod:`ckpt`                                           | null                                                   |                                                                                                                                                    |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+---------------+------------------------------------------------------------------------------------------------------------------------------------+
|                                    | :mod:`logger`                                         | tensorboard                                            | "tensorboard" | "wandb"                                                                                                                            |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+---------------+------------------------------------------------------------------------------------------------------------------------------------+
|                                    | :grey:`cache`                                         | null                                                   | Flag for checking if debug is set to True or False. Reference directly from the main config file.                                                  |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
|                                    | :grey:`dist_url`                                      | null                                                   | When debug is set to True, this value will be used for training.                                                                                   |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
|                                    | :grey:`num_machines`                                  | 1                                                      | Used in initializing PyTorch metrics. Values can be: 'binary', 'multiclass' or 'multilabel'. Default value references from dataset config file.    |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
|                                    | :grey:`machine_rank`                                  | null                                                   |                                                                                                                                                    |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
|                                    | :grey:`dist_backend`                                  | null                                                   |                                                                                                                                                    |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
|                                    | :mod:`output_dir`                                     | './peekingduck/training/outputs'                       |                                                                                                                                                    |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
|                                    | :grey:`seed`                                          | :grey:`${use_case.random_state}`                       | Random seed. Default value will reference directly from the main config file.                                                                      |
+------------------------------------+-------------------------------------------------------+--------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
