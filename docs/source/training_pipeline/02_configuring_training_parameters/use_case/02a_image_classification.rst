.. include:: /include/substitution.rst

*********************
Image Classification
*********************

* :ref:`config-files-overview`
* :ref:`config-files-mainconfig`
* :ref:`config-files-datamodule`
* :ref:`config-files-model`
* :ref:`config-files-modelanalysis`
* :ref:`config-files-trainer`
* :ref:`config-files-metrics`
* :ref:`config-files-callbacks`
* :ref:`config-files-store`


.. _config-files-overview:

Overview
========

We use the YAML syntax for the config file. Below shows the folder structure and describes how users can understand and navigate the config structure. 
Configuration files that are not user-customizable are not included in the table below.

.. parsed-literal::

    \ :blue:`peekingduck/training/configs/` \ |Blank|
          ├── \ :blue:`callbacks/` \ |Blank|
          │      └── classification.yaml
          ├── \ :blue:`data_module/` \ |Blank|
          │      ├── \ :blue:`data_adapter/` \ |Blank|
          │      │      └── adapter.yaml
          │      ├── \ :blue:`dataset/` \ |Blank|
          │      │      ├── cifar10.yaml
          │      │      ├── rsna.yaml
          │      │      ├── vegfru5.yaml
          │      │      ├── vegfru15.yaml
          │      │      └── vegfru25.yaml
          │      ├── \ :blue:`resample/` \ |Blank|
          │      │      └── train_test_split.yaml
          │      ├── \ :blue:`transform/` \ |Blank|
          │      │      ├── test.yaml
          │      │      └── train.yaml
          │      ├── cifar10.yaml
          │      ├── rsna.yaml
          │      ├── vegfru5.yaml
          │      ├── vegfru15.yaml
          │      └── vegfru25.yaml
          ├── \ :blue:`hydra/` \ |Blank|
          │      └── \ :blue:`job_logging/` \ |Blank|
          │             └── custom.yaml
          ├── \ :blue:`metrics/` \ |Blank|
          │      └── classification.yaml
          ├── \ :blue:`model/` \ |Blank|
          │      └── classification.yaml
          ├── \ :blue:`model_analysis/` \ |Blank|
          │      └── classification.yaml
          ├── \ :blue:`stores/` \ |Blank|
          │      └── classification.yaml
          ├── \ :blue:`trainer/` \ |Blank|
          │      └── classification.yaml
          └── config.yaml


+------------------------------------+---------------------------------------------------------------------------------------------------+
| Folder/file under `configs` folder | Description                                                                                       |
+====================================+===================================================================================================+
| config.yaml                        | Main configuration file for high-level training settings such as                                  |
|                                    |                                                                                                   |
|                                    | project name, framework, debug mode, view mode, etc.                                              |
+------------------------------------+---------------------------------------------------------------------------------------------------+
| data_module                        | Main configuration file for data module.                                                          |
|  └── <name_of_the_dataset>.yaml    |                                                                                                   |
|                                    | The only customizable config is `num_debug_samples`.                                              |
+------------------------------------+---------------------------------------------------------------------------------------------------+
| data_module                        | Controls the batch size for train / test dataset, shuffling control, etc.                         |
|  └── data_adapter                  |                                                                                                   |
+------------------------------------+---------------------------------------------------------------------------------------------------+
| data_module                        | | Contains configuration for each dataset in separate .yaml files.                                |
|  └── dataset                       |                                                                                                   |
|                                    | | Customization for the image size and number of classes for image classification.                |
|                                    |                                                                                                   |
|                                    | | User can choose to download the sample dataset when running the pipeline.                       |
|                                    |                                                                                                   |
|                                    | User need to create a separate .yaml file within the folder for custom dataset.                   |
+------------------------------------+---------------------------------------------------------------------------------------------------+
| data_module                        | Controls train/test split and shuffling.                                                          |
|  └── resample                      |                                                                                                   |
+------------------------------------+---------------------------------------------------------------------------------------------------+
| data_module                        | Controls image augmentations / transformations for train / test, such as cropping, flipping, etc. |
|  └── transform                     |                                                                                                   |
+------------------------------------+---------------------------------------------------------------------------------------------------+
| model                              | Controls selection of pre-trained models and fine-tuning model settings                           |
+------------------------------------+---------------------------------------------------------------------------------------------------+
| trainer                            | Control training related parameters including number of epochs,                                   |
|                                    |                                                                                                   |
|                                    | learning rate, loss function, metric and patience for early stopping                              |
+------------------------------------+---------------------------------------------------------------------------------------------------+
| metrics                            | Choose training metrics to monitor during training                                                |
+------------------------------------+---------------------------------------------------------------------------------------------------+

There are two ways to change the default configuration:

1. Update the parameter values inside YAML file for the respective configuration

2. Pass the argument in the command line.

For the second option, you can pass the arguments explicitly stated in the main `config.yaml` file directly in the command line, such as follows:

.. code-block:: bash
   :linenos: 

   cd PeekingDuck
   python ./peekingduck/training/main.py debug=True framework=tensorflow project_name=my_project view_only=True

To change the arguments in other configuration files such as `model`, `trainer`, etc., the user would need to chain up the arguments based on the hierarchy in the yaml files. Here is one example:

.. code-block:: bash
   :linenos: 

   cd PeekingDuck
   python ./peekingduck/training/main.py debug=True framework=pytorch model.pytorch.model_name=mobilenetv3_small_050 trainer.pytorch.global_train_params.debug_epochs=5

Refer to the following sections to learn about the detailed configurations for customized training


----------


.. _config-files-mainconfig:

Main Config
===========

Config File: ``peekingduck/training/configs/config.yaml``

+--------------------------------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
| Key                                                                                  | Value                                                    | Description                                                                         |
+======================================================================================+==========================================================+=====================================================================================+
| :mod:`device`                                                                        | "auto"                                                   | "auto" to select available gpu. "cpu" | "cuda" | "mps"                              |
+--------------------------------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
| :mod:`project_name`                                                                  | "cifar10"                                                | rsna | cifar10 | vegfru5 | vegfru15 | vegfru25 | "your-project-name"                |
+--------------------------------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
| :mod:`debug`                                                                         | True                                                     | True | False                                                                        |
+--------------------------------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
| :mod:`framework`                                                                     | "tensorflow"                                             | "pytorch" | "tensorflow"                                                            |
+--------------------------------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
| :mod:`random_state`                                                                  | 11                                                       | Any number above 0                                                                  |
+--------------------------------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
| :mod:`view_only`                                                                     | False                                                    | True | False                                                                        |
+--------------------------------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
| :mod:`defaults`                                                                      |                                                          |                                                                                     |
+--------------------+-----------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
|                    | :mod:`use_case`                                                 | classification                                           |                                                                                     |
+--------------------+-----------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
|                    | :mod:`data_module`                                              | cifar10                                                  | rsna | cifar10 | vegfru5 | vegfru15 | vegfru25 | "main-data_module-filename"        |
+--------------------+-----------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
|                    | :grey:`model`                                                   | :grey:`${use_case}`                                      |                                                                                     |
+--------------------+-----------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
|                    | :grey:`trainer`                                                 | :grey:`${use_case}`                                      |                                                                                     |
+--------------------+-----------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
|                    | :grey:`callbacks`                                               | :grey:`${use_case}`                                      |                                                                                     |
+--------------------+-----------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
|                    | :grey:`metrics`                                                 | :grey:`${use_case}`                                      |                                                                                     |
+--------------------+-----------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
|                    | :grey:`model_analysis`                                          | :grey:`${use_case}`                                      |                                                                                     |
+--------------------+-----------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
|                    | :grey:`stores`                                                  | :grey:`${use_case}`                                      |                                                                                     |
+--------------------+-----------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
|                    | :grey:`override hydra/job_logging`                              | :grey:`custom`                                           |                                                                                     |
+--------------------+-----------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
| :grey:`hydra`                                                                        |                                                          |                                                                                     |
+--------------------+-----------------------------------------------------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
|                    | :grey:`run`                                                     |                                                          |                                                                                     |
+--------------------+--------------------------------------------+--------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
|                    |                                            | :grey:`dir`        | :grey:`outputs/${project_name}/${stores.unique_id}`      |                                                                                     |
+--------------------+--------------------------------------------+--------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
|                    | :grey:`sweep`                                                   |                                                          |                                                                                     |
+--------------------+--------------------------------------------+--------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
|                    |                                            | :grey:`dir`        | :grey:`outputs/${project_name}/${stores.unique_id}`      |                                                                                     |
+--------------------+--------------------------------------------+--------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+
|                    |                                            | :grey:`subdir`     | :grey:`${hydra.job.num}`                                 |                                                                                     |
+--------------------+--------------------------------------------+--------------------+----------------------------------------------------------+-------------------------------------------------------------------------------------+


----------


.. _config-files-datamodule:

Data Module
===========

Resample / Train Test Split
---------------------------

Split arrays or matrices into random train and test subsets.
Config File : ``peekingduck/training/configs/data_module/resample/train_test_split.yaml``

+---------------------------------------------------------+----------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Key                                                     | Value                                              | Description                                                                                                                                                                                                                                                                                             |
+=========================================================+====================================================+=========================================================================================================================================================================================================================================================================================================+
| :mod:`resample_strategy`                                |                                                    |                                                                                                                                                                                                                                                                                                         |
+--------------------------+------------------------------+----------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                          | :mod:`_target_`              | sklearn.model_selection.train_test_split           | Quick utility that wraps input validation, next(ShuffleSplit().split(X, y)), and application to input data into a single call for splitting (and optionally sub-sampling) data into a one-liner.                                                                                                        |
+--------------------------+------------------------------+----------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                          | :mod:`_partial_`             | True                                               | Partial initialization of function to allow stratify in the dataset.                                                                                                                                                                                                                                    |
+--------------------------+------------------------------+----------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                          | :mod:`test_size`             | 0.125                                              | If float, should be between 0.0 and 1.0 and represent the proportion of the dataset to include in the test split. If int, represents the absolute number of test samples. If None, the value is set to the complement of the train size. If train_size is also None, it will be set to 0.25.            |
+--------------------------+------------------------------+----------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                          | :mod:`shuffle`               | True                                               | Whether or not to shuffle the data before splitting.                                                                                                                                                                                                                                                    |
+--------------------------+------------------------------+----------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                          | :grey:`random_state`         | :grey:`${random_state}`                            | Controls the shuffling applied to the data before applying the split. Pass an int for reproducible output across multiple function calls.                                                                                                                                                               |
+--------------------------+------------------------------+----------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


.. tabs::

      .. tab:: PyTorch

         .. include:: /training_pipeline/02_configuring_training_parameters/data_module/pytorch_config.rst


      .. tab:: TensorFlow

         .. include:: /training_pipeline/02_configuring_training_parameters/data_module/tensorflow_config.rst




Default Datasets
----------------

Config File : ``peekingduck/training/configs/data_module/dataset/``

.. tabs::

   .. tab:: Cifar10

      | https://www.cs.toronto.edu/~kriz/cifar.html. The CIFAR-10 dataset 
      consists of 60000 32x32 color images in 10 classes, with 6000 images per class. 
      There are 50000 training images and 10000 test images. The dataset is 
      divided into five training batches and one test batch, each with 10000 images. 
      The test batch contains exactly 1000 randomly-selected images from each class. 
      The training batches contain the remaining images in random order, but some training 
      batches may contain more images from one class than another. Between them, 
      the training batches contain exactly 5000 images from each class.

      | You can download the dataset here : `dataset/cifar-10`_
      | You can download the labels CSV file here : `csv/cifar-10`_

        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+
        | Key                           | Value                                                                                                                  | Description                                                                    |
        +===============================+========================================================================================================================+================================================================================+
        | :mod:`download`               | FALSE                                                                                                                  | Download from URL below                                                        |
        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+
        | :mod:`url`                    | `https://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz <https://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz>`_   | URL to download the dataset                                                    |
        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+
        | :mod:`blob_file`              | "cifar10.zip"                                                                                                          |                                                                                |
        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+
        | :mod:`root_dir`               | "data"                                                                                                                 |                                                                                |
        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+
        | :mod:`train_dir`              | "./${.root_dir}/${project_name}"                                                                                       |                                                                                |
        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+
        | :mod:`test_dir`               | "./${.root_dir}/${project_name}"                                                                                       |                                                                                |
        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+
        | :mod:`train_csv`              | "./${.root_dir}/${project_name}/train.csv"                                                                             |                                                                                |
        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+
        | :mod:`image_path_col_name`    | "image_path"                                                                                                           | CSV file column name to image path. Allow absolute path or relative path.      |
        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+
        | :mod:`target_col_name`        | "class_name"                                                                                                           | CSV file column name to target string.                                         |
        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+
        | :mod:`target_col_id`          | "class_id"                                                                                                             | CSV file column name to target integer.                                        |
        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+
        | :mod:`stratify_by`            | "${.target_col_name}"                                                                                                  | CSV file column name to be stratify by.                                        |
        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+
        | :mod:`classification_type`    | "multiclass"                                                                                                           | Task type.                                                                     |
        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+
        | :mod:`image_size`             | 224                                                                                                                    | Resized image pixel size.                                                      |
        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+
        | :mod:`num_classes`            | 10                                                                                                                     | Number of classes.                                                             |
        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+
        | :mod:`class_name_to_id`       | airplane: 0                                                                                                            | Dictionary mapping between target `string` and `integer`.                      |
        |                               |                                                                                                                        |                                                                                |
        |                               | automobile: 1                                                                                                          |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        |                               | bird: 2                                                                                                                |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        |                               | cat: 3                                                                                                                 |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        |                               | deer: 4                                                                                                                |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        |                               | dog: 5                                                                                                                 |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        |                               | frog: 6                                                                                                                |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        |                               | horse: 7                                                                                                               |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        |                               | ship: 8                                                                                                                |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        |                               | truck: 9                                                                                                               |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+
        | :mod:`classes`                | `-` airplane                                                                                                           | List of class labels                                                           |
        |                               |                                                                                                                        |                                                                                |
        |                               | `-` automobile                                                                                                         |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        |                               | `-` bird                                                                                                               |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        |                               | `-` cat                                                                                                                |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        |                               | `-` deer                                                                                                               |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        |                               | `-` dog                                                                                                                |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        |                               | `-` frog                                                                                                               |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        |                               | `-` horse                                                                                                              |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        |                               | `-` ship                                                                                                               |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        |                               | `-` truck                                                                                                              |                                                                                |
        |                               |                                                                                                                        |                                                                                |
        +-------------------------------+------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------+


   .. tab:: Vegfru

      Based on the dataset from https://github.com/ustc-vim/vegfru. For the paper "VegFru: A Domain-Specific Dataset for Fine-grained Visual Categorization".

      | You can download the dataset here : `dataset/vegfru`_
      | You can download the labels CSV file here : `csv/vegfru5`_ | `csv/vegfru15`_ | `csv/vegfru25`_
      
        +----------------------------------+------------------------------------------------------+--------------------------------------------------+--------------------------------------------+-------------------------------------------------------------------------------+
        | Key                              | VegFru5                                              | VegFru15                                         | VegFru25                                   | Description                                                                   |
        +==================================+======================================================+==================================================+============================================+===============================================================================+
        | :mod:`download`                  | FALSE                                                                                                                                                | Download from URL below                                                       |
        +----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------+
        | :mod:`url`                       | ""                                                                                                                                                   | URL to download the dataset                                                   |
        +----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------+
        | :mod:`blob_file`                 | "vegfru.zip"                                                                                                                                         |                                                                               |
        +----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------+
        | :mod:`root_dir`                  | "data"                                                                                                                                               |                                                                               |
        +----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------+
        | :mod:`train_dir`                 | "./${.root_dir}/vegfru"                                                                                                                              |                                                                               |
        +----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------+
        | :mod:`test_dir`                  | "./${.root_dir}/vegfru"                                                                                                                              |                                                                               |
        +----------------------------------+------------------------------------------------------+--------------------------------------------------+--------------------------------------------+-------------------------------------------------------------------------------+
        | :mod:`train_csv`                 | "./${.root_dir}/vegfru/vegfru5.csv"                  | "./${.root_dir}/vegfru/vegfru15.csv"             | "./${.root_dir}/vegfru/train.csv"          |                                                                               |
        +----------------------------------+------------------------------------------------------+--------------------------------------------------+--------------------------------------------+-------------------------------------------------------------------------------+
        | :mod:`image_path_col_name`       | "image_path"                                                                                                                                         | CSV file column name to image path. Allow absolute path or relative path.     |
        +----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------+
        | :mod:`target_col_name`           | "class_name"                                                                                                                                         | CSV file column name to target string.                                        |
        +----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------+
        | :mod:`target_col_id`             | "class_id"                                                                                                                                           | CSV file column name to target integer.                                       |
        +----------------------------------+------------------------------------------------------+--------------------------------------------------+--------------------------------------------+-------------------------------------------------------------------------------+
        | :mod:`stratify_by`               | class_id                                             | class_id                                         | class_name                                 | CSV file column name to be stratify by.                                       |
        +----------------------------------+------------------------------------------------------+--------------------------------------------------+--------------------------------------------+-------------------------------------------------------------------------------+
        | :mod:`classification_type`       | "multiclass"                                                                                                                                         | Task type.                                                                    |
        +----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------+
        | :mod:`image_size`                | 224                                                                                                                                                  | Image pixel size.                                                             |
        +----------------------------------+------------------------------------------------------+--------------------------------------------------+--------------------------------------------+-------------------------------------------------------------------------------+
        | :mod:`num_classes`               | 5                                                    | 15                                               | 25                                         | Number of classes.                                                            |
        +----------------------------------+------------------------------------------------------+--------------------------------------------------+--------------------------------------------+-------------------------------------------------------------------------------+
        | :mod:`class_name_to_id`          | "garlic": 0                                          | "garlic": 0                                      | "alliaceous": 0                            | Dictionary mapping between the class label and its id.                        |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  | "cattail": 1                                         | "cattail": 1                                     | "aquatic_vegetable": 1                     | `string` and `integer`                                                        | 
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  | "soybean": 2                                         | "soybean": 2                                     | "beans": 2                                 |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  | "red_cabbage": 3                                     | "red_cabbage": 3                                 | "brassia_olreacea": 3                      |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  | "mung_bean_sprouts": 4                               | "mung_bean_sprouts": 4                           | "bug_seedling": 4                          |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      | "pakchoi": 5                                     | "cabbage": 5                               |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      | "eggplant": 6                                    | "eggplant": 6                              |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      | "chrysanthemum": 7                               | "green_leafy_vegatable": 7                 |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      | "snake_gourd": 8                                 | "melon": 8                                 |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      | "nameko": 9                                      | "mushroom": 9                              |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      | "mustard": 10                                    | "mustard": 10                              |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      | "Lily": 11                                       | "perennial": 11                            |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      | "beetroot": 12                                   | "root_vegetable": 12                       |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      | "kudzu": 13                                      | "tuber_vagetable": 13                      |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      | "fallopia_multiflora": 14                        | "wild_vegetable": 14                       |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      |                                                  | "berry_fruit": 15                          |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      |                                                  | "citrus_fruit": 16                         |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      |                                                  | "collective_fruit": 17                     |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      |                                                  | "cucurbites": 18                           |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      |                                                  | "drupe": 19                                |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      |                                                  | "litchies": 20                             |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      |                                                  | "nut_fruit": 21                            |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      |                                                  | "persimmons_and_jujubes_fruit": 22         |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      |                                                  | "pome": 23                                 |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        |                                  |                                                      |                                                  | "other_fruit": 24                          |                                                                               |
        |                                  |                                                      |                                                  |                                            |                                                                               |
        +----------------------------------+------------------------------------------------------+--------------------------------------------------+--------------------------------------------+-------------------------------------------------------------------------------+


   .. tab:: RSNA

      https://www.kaggle.com/competitions/rsna-breast-cancer-detection/data. The goal of this dataset is to identify cases of breast cancer in mammograms from screening exams. It is important to identify cases of cancer for obvious reasons, but false positives also have downsides for patients. As millions of women get mammograms each year, a useful machine learning tool could help a great many people.

      | You can download the dataset here : `dataset/rsna`_
      | You can download the labels CSV file here : `csv/rsna`_

        +--------------------------------+----------------------------------------------------+----------------------------------------------------------------------------+
        | Key                            | Value                                              | Description                                                                |
        +================================+====================================================+============================================================================+
        | :mod:`download`                | False                                              | Download from URL below                                                    |
        +--------------------------------+----------------------------------------------------+----------------------------------------------------------------------------+
        | :mod:`url`                     | ""                                                 | URL to download the dataset                                                |
        +--------------------------------+----------------------------------------------------+----------------------------------------------------------------------------+
        | :mod:`blob_file`               | "rsna.zip"                                         |                                                                            |
        +--------------------------------+----------------------------------------------------+----------------------------------------------------------------------------+
        | :mod:`root_dir`                | "data"                                             |                                                                            |
        +--------------------------------+----------------------------------------------------+----------------------------------------------------------------------------+
        | :mod:`train_dir`               | "./${.root_dir}/${project_name}"                   |                                                                            |
        +--------------------------------+----------------------------------------------------+----------------------------------------------------------------------------+
        | :mod:`test_dir`                | "./${.root_dir}/${project_name}"                   |                                                                            |
        +--------------------------------+----------------------------------------------------+----------------------------------------------------------------------------+
        | :mod:`train_csv`               | "./${.root_dir}/${project_name}/train.csv"         |                                                                            |
        +--------------------------------+----------------------------------------------------+----------------------------------------------------------------------------+
        | :mod:`image_path_col_name`     | "image_path"                                       | CSV file column name to image path. Allow absolute path or relative path.  |
        +--------------------------------+----------------------------------------------------+----------------------------------------------------------------------------+
        | :mod:`target_col_name`         | "class_name"                                       | CSV file column name to target string.                                     |
        +--------------------------------+----------------------------------------------------+----------------------------------------------------------------------------+
        | :mod:`target_col_id`           | "class_id"                                         | CSV file column name to target integer.                                    |
        +--------------------------------+----------------------------------------------------+----------------------------------------------------------------------------+
        | :mod:`stratify_by`             | "${.target_col_name}"                              | CSV file column name to be stratify by.                                    |
        +--------------------------------+----------------------------------------------------+----------------------------------------------------------------------------+
        | :mod:`classification_type`     | "multiclass"                                       | Task type.                                                                 |
        +--------------------------------+----------------------------------------------------+----------------------------------------------------------------------------+
        | :mod:`image_size`              | 224                                                | Resized image pixel size.                                                  |
        +--------------------------------+----------------------------------------------------+----------------------------------------------------------------------------+
        | :mod:`num_classes`             | 2                                                  | Number of classes.                                                         |
        +--------------------------------+----------------------------------------------------+----------------------------------------------------------------------------+
        | :mod:`class_name_to_id`        | benign: 0                                          | Dictionary mapping between the class label and its id.                     |
        |                                |                                                    |                                                                            |
        |                                | malignant: 1                                       | `string` and `integer`                                                     |
        +--------------------------------+----------------------------------------------------+----------------------------------------------------------------------------+




.. _`dataset/cifar-10`: https://storage.googleapis.com/peekingduck/data/cifar10.zip
.. _`csv/cifar-10`: https://github.com/aisingapore/PeekingDuck/blob/feat-training/data/cifar10/train.csv

.. _`dataset/vegfru`: https://storage.googleapis.com/peekingduck/data/vegfru.zip
.. _`csv/vegfru5`: https://github.com/aisingapore/PeekingDuck/blob/feat-training/data/vegfru/vegfru5.csv
.. _`csv/vegfru15`: https://github.com/aisingapore/PeekingDuck/blob/feat-training/data/vegfru/vegfru15.csv
.. _`csv/vegfru25`: https://github.com/aisingapore/PeekingDuck/blob/feat-training/data/vegfru/vegfru25.csv

.. _`dataset/rsna`: https://storage.googleapis.com/peekingduck/data/rsna.zip
.. _`csv/rsna`: https://github.com/aisingapore/PeekingDuck/blob/feat-training/data/rsna/train.csv


----------


.. _config-files-model:

Model
=====

.. tabs::

   .. tab:: PyTorch

      Config File : ``peekingduck/training/configs/model/classification.yaml``

        +------------------------------------------------------+-------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
        | Key                                                  | Value                                           | Description                                                                                                                                                                                                                                                             |
        +======================================================+=================================================+=========================================================================================================================================================================================================================================================================+
        | :mod:`adapter`                                       | "timm"                                          | | PeekingDuck supports pre-trained models from both :mod:`torchvision` and :mod:`timm` libraries.                                                                                                                                                                       |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 | Refer to the FAQ section for choosing between the two adapters for pre-trained models                                                                                                                                                                                   |
        +------------------------------------------------------+-------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
        | :grey:`task`                                         | :grey:`${use_case}`                             | :grey:`Should not be changed. For hydra interpolation.`                                                                                                                                                                                                                 |
        +------------------------------------------------------+-------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
        | :mod:`model_name`                                    | "vgg16"                                         | | Supported model names from :mod:`torchvision` and :mod:`timm`.                                                                                                                                                                                                        |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 | | For :mod:`torchvision`, refer to the `official docs <https://pytorch.org/vision/stable/models.html#classification>`_ for the list of the model. Click on the links and use the class name as the model name in the configuration file.                                |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 | | For example, to use a vgg16 model, click the `VGG link <https://pytorch.org/vision/stable/models/vgg.html>`_ and use :mod:`vgg16` as the value for the model name.                                                                                                    |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 | | For :mod:`timm`, use :mod:`timm.list_models(pretrained=True)` to list out all the supported models, and use the string value as the value for the model name.                                                                                                         |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 | Refer to the `official docs <https://timm.fast.ai/#List-Models-with-Pretrained-Weights>`_ for advanced searching.                                                                                                                                                       |
        +------------------------------------------------------+-------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
        | :mod:`weights`                                       | "DEFAULT"                                       | | Only applicable to :mod:`torchvision` adapters.                                                                                                                                                                                                                       |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 | | Set as :mod:`DEFAULT` (recommended) to use default pre-trained weights, or change to alternative pre-trained weights (if supported) described in the documentation for the specific model.                                                                            |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 | Refer to `mobilenet_v3_large <https://pytorch.org/vision/stable/models/generated/torchvision.models.mobilenet_v3_large.html#torchvision.models.MobileNet_V3_Large_Weights>`_ for an example.                                                                            |
        +------------------------------------------------------+-------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
        | :mod:`pretrained`                                    | True                                            | Only applicable to :mod:`timm` adapters.                                                                                                                                                                                                                                |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 | If set to :mod:`False`, the weights will be initialized randomly.                                                                                                                                                                                                       |
        +------------------------------------------------------+-------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
        | :mod:`fine_tune`                                     | True                                            | :mod:`True` to fine-tune the model after training the classifier.                                                                                                                                                                                                       |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 | :mod:`False` to only train the classifier.                                                                                                                                                                                                                              |
        +------------------------------------------------------+-------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
        | :mod:`fine_tune_all`                                 | True                                            | Only applicable when :mod:`fine_tune` is set to :mod:`True`                                                                                                                                                                                                             |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 | :mod:`True` to fine-tune the model after training the classifier.                                                                                                                                                                                                       |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 | :mod:`False` to only train the classifier.                                                                                                                                                                                                                              |
        +------------------------------------------------------+-------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
        | :mod:`fine_tune_modules`                             |                                                 | | Only applicable when :mod:`fine_tune_all` is set to :mod:`False`                                                                                                                                                                                                      |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 | | Specify which block within the model to fine-tune, accessed by the name.                                                                                                                                                                                              |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 | | The settings will depend on the selected model since each model architecture names the sub-modules differently.                                                                                                                                                       |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 | | The sub-keys are the name of the modules to fine-tune, which can be viewed in the model print-out when setting :mod:`view_only` to :mod:`True` in the main configuration file.                                                                                        |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 |                                                                                                                                                                                                                                                                         |
        |                                                      |                                                 | The values represent the layer/sub-modules to fine-tune, which can be an integer or a list of strings. For an integer "n", it sets the last "n" layer/sub-modules to fine-tune. For a list of strings, it sets the layer/sub-modules to fine-tune by names.             |
        +------------------------------+-----------------------+-------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
        |                              | :mod:`features`       | 7                                               | This is an example value. For "vgg16" model,                                                                                                                                                                                                                            |
        |                              |                       |                                                 |                                                                                                                                                                                                                                                                         |
        |                              |                       |                                                 | this will set the last :mod:`7` layers within the :mod:`feature` module as trainable                                                                                                                                                                                    |
        +------------------------------+-----------------------+-------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
        |                              | :mod:`pre_logits`     | [ "fc1", "act1", "drop", "fc2", "act2" ]        | This is an example value. For "vgg16" model,                                                                                                                                                                                                                            |
        |                              |                       |                                                 |                                                                                                                                                                                                                                                                         |
        |                              |                       |                                                 | this will set the :mod:`"fc1", "act1", "drop", "fc2", "act2"` modules as trainable                                                                                                                                                                                      |
        +------------------------------+-----------------------+-------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
        | :grey:`num_classes`                                  | :grey:`${data_module.dataset.num_classes}`      | :grey:`Should not be changed. For hydra interpolation.`                                                                                                                                                                                                                 |
        +------------------------------------------------------+-------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
        | :grey:`device`                                       | :grey:`${device}`                               | :grey:`Should not be changed. For hydra interpolation.`                                                                                                                                                                                                                 |
        +------------------------------------------------------+-------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


   .. tab:: TensorFlow
   
      Config File : ``peekingduck/training/configs/model/classification.yaml``

        +------------------------------+------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
        | Key                          | Value                                                                                                | Description                                                                                                                                   |
        +==============================+======================================================================================================+===============================================================================================================================================+
        | :grey:`task`                 | :grey:`${use_case}`                                                                                  | :grey:`Should not be changed. For hydra interpolation.`                                                                                       |
        +------------------------------+------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
        | :mod:`model_name`            | "VGG16"                                                                                              | Supported model names from :mod:`tf.keras.applications.`                                                                                      |
        |                              |                                                                                                      |                                                                                                                                               |
        |                              |                                                                                                      | Refer to the `official docs <https://www.tensorflow.org/api_docs/python/tf/keras/applications#functions>`_ for the list of the model.         |
        |                              |                                                                                                      |                                                                                                                                               |
        |                              |                                                                                                      | Use the name of the function as the string value for the model name.                                                                          |
        +------------------------------+------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
        | :grey:`num_classes`          | :grey:`${data_module.dataset.num_classes}`                                                           | :grey:`Should not be changed. For hydra interpolation.`                                                                                       |
        +------------------------------+------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
        | :mod:`activation`            | "softmax"                                                                                            | Activation function for the last layer of the classifier. Should not be changed.                                                              |
        +------------------------------+------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
        | :grey:`image_size`           | :grey:`${data_module.dataset.image_size}`                                                            | :grey:`Should not be changed. For hydra interpolation.`                                                                                       |
        +------------------------------+------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
        | :grey:`device`               | :grey:`${device}`                                                                                    | :grey:`Should not be changed. For hydra interpolation.`                                                                                       |
        +------------------------------+------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
        | :mod:`pretrained`            | True                                                                                                 | Whether to use the pre-trained weights.                                                                                                       |
        +------------------------------+------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
        | :mod:`fine_tune`             | True                                                                                                 | Control whether to fine-tune the model after training the classifier.                                                                         |
        +------------------------------+------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
        | :mod:`fine_tune_all`         | True                                                                                                 | Only applicable when :mod:`fine_tune` is set to :mod:`True`                                                                                   |
        |                              |                                                                                                      |                                                                                                                                               |
        |                              |                                                                                                      | :mod:`True` to fine-tune the model after training the classifier.                                                                             |
        |                              |                                                                                                      |                                                                                                                                               |
        |                              |                                                                                                      | :mod:`False` to only train the classifier.                                                                                                    |
        +------------------------------+------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
        | :mod:`fine_tune_layers`      | [ "prediction_modified", "fc2", "fc1", "block5_conv3", "block5_conv2", "block5_conv1", ]             | Unfreeze the layers by layer names to fine-tune. The name of the layers can be viewed by the model print-out.                                 |
        +------------------------------+------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+


----------


.. _config-files-modelanalysis:

Model Analysis
==============

Config File : ``peekingduck/training/configs/model_analysis/classification.yaml``

+------------------------------+-----------------------------------------+----------------------+
| Key                          | Value                                   | Description          |
+==============================+=========================================+======================+
| :mod:`entity`                | "peekingduck"                           |                      |
+------------------------------+-----------------------------------------+----------------------+
| :grey:`project`              | :grey:`"${project_name}"`               |                      |
+------------------------------+-----------------------------------------+----------------------+
| :grey:`run_name`             | :grey:`"${stores.unique_id}"`           |                      |
+------------------------------+-----------------------------------------+----------------------+
| :grey:`framework`            | :grey:`"${framework}"`                  |                      |
+------------------------------+-----------------------------------------+----------------------+
| :grey:`debug`                | :grey:`${debug}`                        |                      |
+------------------------------+-----------------------------------------+----------------------+


----------


.. _config-files-trainer:

Trainer
=======

.. tabs::

   .. tab:: PyTorch

      .. include:: /training_pipeline/02_configuring_training_parameters/trainer/pytorch_config.rst

   .. tab:: TensorFlow

      .. include:: /training_pipeline/02_configuring_training_parameters/trainer/tensorflow_config.rst


----------


.. _config-files-metrics:

Metrics
=======

.. tabs::

   .. tab:: PyTorch

        | Refer to `Torch Metrics <https://torchmetrics.readthedocs.io/en/stable/all-metrics.html>`_ documentation for more metrics you can use and their details.
        | Values listed here are taken from the torch metrics API. It is important to note that the values are case-sensitive.
        | The table below shows the default metrics:
 

        Config file : ``peekingduck/training/configs/metrics/classification.yaml``


        +----------------------------------------+---------------+------------------------------------------------------------------------------------------------------------------+
        | Key                                    | Value         | Description                                                                                                      |
        +========================================+===============+==================================================================================================================+
        | :mod:`Accuracy`                        |               |                                                                                                                  |
        +-------------------+--------------------+---------------+------------------------------------------------------------------------------------------------------------------+
        |                   | :mod:`average`     | "micro"       | "micro": Sum statistics over all labels                                                                          |
        |                   |                    |               |                                                                                                                  |
        |                   |                    |               | "macro": Calculate statistics for each label and average them                                                    |
        |                   |                    |               |                                                                                                                  |
        |                   |                    |               | "weighted": Calculates statistics for each label and computes weighted average using their support "none"        |
        |                   |                    |               |                                                                                                                  |
        |                   |                    |               | None: Calculates statistic for each label and applies no reduction                                               |
        +-------------------+--------------------+---------------+------------------------------------------------------------------------------------------------------------------+
        | :mod:`Precision`                       |               |                                                                                                                  |
        +-------------------+--------------------+---------------+------------------------------------------------------------------------------------------------------------------+
        |                   | :mod:`average`     | "macro"       | "micro": Sum statistics over all labels                                                                          |
        |                   |                    |               |                                                                                                                  |
        |                   |                    |               | "macro": Calculate statistics for each label and average them                                                    |
        |                   |                    |               |                                                                                                                  |
        |                   |                    |               | "weighted": Calculates statistics for each label and computes weighted average using their support "none"        |
        |                   |                    |               |                                                                                                                  |
        |                   |                    |               | None: Calculates statistic for each label and applies no reduction                                               |
        +-------------------+--------------------+---------------+------------------------------------------------------------------------------------------------------------------+
        | :mod:`Recall`                          |               |                                                                                                                  |
        +----------------------------------------+---------------+------------------------------------------------------------------------------------------------------------------+
        | :mod:`AUROC`                           |               |                                                                                                                  |
        +-------------------+--------------------+---------------+------------------------------------------------------------------------------------------------------------------+
        |                   | :mod:`average`     | "weighted"    | "micro": Sum statistics over all labels                                                                          |
        |                   |                    |               |                                                                                                                  |
        |                   |                    |               |                                                                                                                  |
        |                   |                    |               | "macro": Calculate statistics for each label and average them                                                    |
        |                   |                    |               |                                                                                                                  |
        |                   |                    |               | "weighted": Calculates statistics for each label and computes weighted average using their support "none"        |
        |                   |                    |               |                                                                                                                  |
        |                   |                    |               | None: Calculates statistic for each label and applies no reduction                                               |
        +-------------------+--------------------+---------------+------------------------------------------------------------------------------------------------------------------+

   .. tab:: TensorFlow

        | Refer to the `TensorFlow v2 Metrics <https://www.tensorflow.org/api_docs/python/tf/keras/metrics>`_ documentation for more metrics you can use and their details.
        | Values listed here are taken from the TensorFlow Keras metrics API. It is important to note that the values are case-sensitive.
        | The table below shows the default metrics:


        Config file : ``peekingduck/training/configs/metrics/classification.yaml``

        +-----------------------------------------------------+--------------------------------------------------+----------------------+
        | Key                                                 | Value                                            | Description          |
        +=====================================================+==================================================+======================+
        | :mod:`CategoricalAccuracy`                          |                                                  |                      |
        +-----------------------------------------------------+--------------------------------------------------+----------------------+
        | :mod:`Precision`                                    |                                                  |                      |
        +--------------------------+--------------------------+--------------------------------------------------+----------------------+
        |                          | :mod:`thresholds`        | 0.5                                              |                      |
        +--------------------------+--------------------------+--------------------------------------------------+----------------------+
        | :mod:`Recall`                                       |                                                  |                      |
        +--------------------------+--------------------------+--------------------------------------------------+----------------------+
        |                          | :mod:`thresholds`        | 0.5                                              |                      |
        +--------------------------+--------------------------+--------------------------------------------------+----------------------+
        | :mod:`AUC`                                          |                                                  |                      |
        +--------------------------+--------------------------+--------------------------------------------------+----------------------+
        |                          | :mod:`from_logits`       | False                                            |                      |
        +--------------------------+--------------------------+--------------------------------------------------+----------------------+
        |                          | :mod:`multi_label`       | True                                             |                      |
        +--------------------------+--------------------------+--------------------------------------------------+----------------------+
        |                          | :mod:`num_labels`        | :grey:`${data_module.dataset.num_classes}`       |                      |
        +--------------------------+--------------------------+--------------------------------------------------+----------------------+


----------


.. _config-files-callbacks:

Callbacks
=========

.. tabs::

   .. tab:: PyTorch

        These are the only available callbacks currently. It is important to note that the callbacks are automatically sorted (as per the list sequence below) during initialization:

        #. History (required)
        #. MetricMeter (required)
        #. ModelCheckpoint (required)
        #. Logger
        #. EarlyStopping

        The table below shows the default values:

        Config File : ``peekingduck/training/configs/callbacks/classification.yaml``

        +---------------------------------------------------+---------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
        | Key                                               | Value                                                                     | Description                                                                              |
        +===================================================+===========================================================================+==========================================================================================+
        | :mod:`Logger`                                     |                                                                           | In charge of printing the train and validation loop metrics and summaries.               |
        +---------------------------------------------------+---------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
        | :mod:`EarlyStopping`                              |                                                                           | Stop training when a monitored metric has stopped improving.                             |
        +---------------------------+-----------------------+---------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
        |                           | :grey:`patience`      | :grey:`${trainer.pytorch.global_train_params.patience}`                   | Number of epochs with no improvement after which training will be stopped.               |
        +---------------------------+-----------------------+---------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
        |                           | :grey:`monitor`       | :grey:`${trainer.pytorch.global_train_params.monitored_metric.monitor}`   | Name of the metric to monitor, should be one of the keys in the metrics list.            |
        +---------------------------+-----------------------+---------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
        |                           | :grey:`mode`          | :grey:`${trainer.pytorch.global_train_params.monitored_metric.mode}`      | | "min" or "max"                                                                         |
        |                           |                       |                                                                           |                                                                                          |
        |                           |                       |                                                                           |                                                                                          |
        |                           |                       |                                                                           | In "min" mode, training will stop when the quantity monitored has stopped decreasing     |
        |                           |                       |                                                                           |                                                                                          |
        |                           |                       |                                                                           | In "max" mode it will stop when the quantity monitored has stopped increasing.           |
        +---------------------------+-----------------------+---------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
        | :mod:`History`                                    |                                                                           | Callback that records events into a History object.                                      |
        +---------------------------------------------------+---------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
        | :mod:`MetricMeter`                                |                                                                           | | Calculates the cumulative metric score, cumulative count and average score             |
        |                                                   |                                                                           |                                                                                          |
        |                                                   |                                                                           |                                                                                          |
        |                                                   |                                                                           | Note after 1 full loop epoch,                                                            |
        |                                                   |                                                                           |                                                                                          |
        |                                                   |                                                                           | the model has traversed through all batches in the dataloader.                           |
        |                                                   |                                                                           |                                                                                          |
        |                                                   |                                                                           | So, the average score is the average of all batches in the dataloader.                   |
        |                                                   |                                                                           |                                                                                          |
        |                                                   |                                                                           | for eg, if the train set has 1000 samples and the batch size is 100,                     |
        |                                                   |                                                                           |                                                                                          |
        |                                                   |                                                                           | then the model will have traversed through 10 batches in 1 epoch.                        |
        |                                                   |                                                                           |                                                                                          |
        |                                                   |                                                                           | then the cumulative count is "step" which is 10 in this case.                            |
        |                                                   |                                                                           |                                                                                          |
        |                                                   |                                                                           | the cumulative metric score is the sum of all the metric scores of all batches.          |
        |                                                   |                                                                           |                                                                                          |
        |                                                   |                                                                           | so add up all the metric scores of all batches and divide by the cumulative count.       |
        |                                                   |                                                                           |                                                                                          |
        |                                                   |                                                                           | this is the average score of all batches in 1 epoch.                                     |
        +---------------------------------------------------+---------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
        | :mod:`ModelCheckpoint`                            |                                                                           | Callback to save the model or model weights at some frequency.                           |
        +---------------------------+-----------------------+---------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
        |                           | :grey:`monitor`       | :grey:`${trainer.pytorch.global_train_params.monitored_metric.monitor}`   | Name of the metric to monitor, should be one of the keys in the metrics list.            |
        +---------------------------+-----------------------+---------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
        |                           | :grey:`mode`          | :grey:`${trainer.pytorch.global_train_params.monitored_metric.mode}`      | | "max" or "min"                                                                         |
        |                           |                       |                                                                           |                                                                                          |
        |                           |                       |                                                                           |                                                                                          |
        |                           |                       |                                                                           | In "min" mode, training will stop when the quantity monitored has stopped decreasing     |
        |                           |                       |                                                                           |                                                                                          |
        |                           |                       |                                                                           | In "max" mode it will stop when the quantity monitored has stopped increasing.           |
        +---------------------------+-----------------------+---------------------------------------------------------------------------+------------------------------------------------------------------------------------------+


   .. tab:: TensorFlow

        Check out the `TensorFlow v2 Callbacks <https://www.tensorflow.org/api_docs/python/tf/keras/callbacks>`_ documentation for more details.
        While technically you can use any callbacks listed in the Keras API, only EarlyStopping has been tested.

        The table below shows the default values:

        Config File : ``peekingduck/training/configs/callbacks/classification.yaml``

        +------------------------------------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
        | Key                                                        | Value                                                                             | Description                                                                                                                             |
        +============================================================+===================================================================================+=========================================================================================================================================+
        | :mod:`EarlyStopping`                                       |                                                                                   | Stop training when a monitored metric has stopped improving.                                                                            |
        +--------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
        |                          | :mod:`patience`                 | 3                                                                                 | Number of epochs with no improvement after which training will be stopped.                                                              |
        +--------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
        |                          | :mod:`restore_best_weights`     | True                                                                              | Whether to restore model weights from the epoch with the best value of the monitored quantity.                                          |
        |                          |                                 |                                                                                   |                                                                                                                                         |
        |                          |                                 |                                                                                   | If False, the model weights obtained at the last step of training are used.                                                             |
        |                          |                                 |                                                                                   |                                                                                                                                         |
        |                          |                                 |                                                                                   | An epoch will be restored regardless of the performance relative to the baseline.                                                       |
        |                          |                                 |                                                                                   |                                                                                                                                         |
        |                          |                                 |                                                                                   | If no epoch improves on the baseline, training will run for patience epochs and restore weights from the best epoch in that set.        |
        +--------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
        |                          | :mod:`monitor`                  | "val_categorical_accuracy"                                                        | Metric to be monitored.                                                                                                                 |
        +--------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
        | :mod:`ProgbarLogger`                                       |                                                                                   |                                                                                                                                         |
        +--------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
        |                          | :mod:`count_mode`               | 'steps'                                                                           |                                                                                                                                         |
        +--------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
        |                          | :mod:`stateful_metrics`         | Null                                                                              |                                                                                                                                         |
        +--------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
        | :mod:`ModelCheckpoint`                                     |                                                                                   | Save model checkpoints based on specified save_freq parameter frequency.                                                                |
        +--------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
        |                          | :grey:`filepath`                | :grey:`${trainer.tensorflow.stores.model_artifacts_dir}`                          |                                                                                                                                         |
        +--------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
        |                          | :grey:`monitor`                 | :grey:`${trainer.tensorflow.global_train_params.monitored_metric.monitor}`        |                                                                                                                                         |
        +--------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
        |                          | :mod:`save_best_only`           | False                                                                             |                                                                                                                                         |
        +--------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
        |                          | :mod:`save_weights_only`        | False                                                                             |                                                                                                                                         |
        +--------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
        |                          | :mod:`mode`                     | 'auto'                                                                            |                                                                                                                                         |
        +--------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
        |                          | :mod:`save_freq`                | 'epoch'                                                                           |                                                                                                                                         |
        +--------------------------+---------------------------------+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+


----------


.. _config-files-store:

Store
=====

Config File : ``peekingduck/training/configs/stores/classifications.yaml``

+----------------------------------+-----------------------------------+------------------------------------------------------------+
| Key                              | Value                             | Description                                                |
+==================================+===================================+============================================================+
| :grey:`unique_id`                | :grey:`${now:%Y%m%d_%H%M%S}`      | :grey:`Used in:`                                           |
|                                  |                                   |                                                            |
|                                  |                                   | :grey:`- Hydra run and sweep directory path`               |
|                                  |                                   |                                                            |
|                                  |                                   | :grey:`- Model analysis run_name`                          |
|                                  |                                   |                                                            |
|                                  |                                   | :grey:`- Pytorch Training model artifacts directory`       |
+----------------------------------+-----------------------------------+------------------------------------------------------------+
